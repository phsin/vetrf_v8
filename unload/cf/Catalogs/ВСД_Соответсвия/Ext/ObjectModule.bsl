
Процедура ОчиститьРеквизитОсновноеСоответствие()
	
	РезультатЗапроса = ВыборкаПоСправочнику();
	Пока РезультатЗапроса.Следующий() Цикл
		ВСД_Соответствие = РезультатЗапроса.элСоответствие.ПолучитьОбъект();
		ВСД_Соответствие.ОсновноеСоответствие = Ложь;
		ВСД_Соответствие.Записать();
	КонецЦикла;
	
КонецПроцедуры

Функция ПроверитьЗаполнениеРеквизитаОсновноеСоответствие()
	
	Если ВыборкаПоСправочнику().Следующий() Тогда
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли;
	
КонецФункции

Функция ВыборкаПоСправочнику()
	
	Запрос = Новый Запрос;
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ВСД_Соответсвия.Ссылка КАК элСоответствие
	|ИЗ
	|	Справочник.ВСД_Соответсвия КАК ВСД_Соответсвия
	|ГДЕ
	|	НЕ ВСД_Соответсвия.ПометкаУдаления
	|	И ВСД_Соответсвия.ОсновноеСоответствие
	|	И ВСД_Соответсвия.Владелец = &Владелец
	|";
	Если ЗначениеЗаполнено(Ссылка) Тогда
		ТекстЗапроса = ТекстЗапроса + "И ВСД_Соответсвия.Ссылка <> &Ссылка";
		Запрос.УстановитьПараметр("Ссылка", Ссылка);
	КонецЕсли;
	
	Запрос.УстановитьПараметр("Владелец", Владелец);
	Запрос.Текст = ТекстЗапроса;
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Возврат Выборка;
	
КонецФункции

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	Если ОсновноеСоответствие Тогда
		ОчиститьРеквизитОсновноеСоответствие();
	Иначе
		Если Не ПроверитьЗаполнениеРеквизитаОсновноеСоответствие() Тогда
			ОсновноеСоответствие = Истина;
		КонецЕсли;
	КонецЕсли
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	
	Если ЭтоНовый() Тогда
		Если Не ПроверитьЗаполнениеРеквизитаОсновноеСоответствие() Тогда
			ОсновноеСоответствие = Истина;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры
