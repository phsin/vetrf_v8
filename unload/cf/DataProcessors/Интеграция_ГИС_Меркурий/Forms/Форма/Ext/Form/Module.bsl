
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Объект.Организация = Параметры.Организация;
	Объект.param_username = Параметры.ЛогинВетис;
	ВерсияОбработки = Параметры.ВерсияОбработки;
	
	ПолучитьИнформациюОбОбновленияхНаСервере();
	
КонецПроцедуры

&НаКлиенте
Процедура АктуальнаяВерсияНажатие(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	Оповещение = Новый ОписаниеОповещения("ЗапускПриложения", ЭтаФорма);
	НачатьЗапускПриложения(Оповещение, СсылкаНаОписаниеАктуальнойВерсии,, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьИнформацию(Команда)
	
	ПолучитьИнформациюОбОбновленияхНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ПолучитьИнформациюОбОбновленияхНаСервере()

	НаименованиеОрганизации = Объект.Организация.Наименование;
	ИНН = Объект.Организация.ИНН;
	ЛогинВетис = Объект.param_username;
	
	Если ЗначениеЗаполнено(Объект.Организация) Тогда
		
		ПараметрыЗапроса = Новый Структура();
		ПараметрыЗапроса.Вставить("ИНН",					 ИНН);
		ПараметрыЗапроса.Вставить("НаименованиеОрганизации", НаименованиеОрганизации);
		ПараметрыЗапроса.Вставить("ЛогинВетис",				 ЛогинВетис);
		ПараметрыЗапроса.Вставить("ТекущаяВерсия",			 ВерсияОбработки);
		
		ОтветСервера = кб99_ВСД_Отправка.ПолучитьДанныеОтехподдержке(ПараметрыЗапроса);
		Если Не ОтветСервера.Ошибка Тогда
			ПоказатьВерсиюНаФорме( ОтветСервера );
		КонецЕсли;
		
	Иначе
		Элементы.НадписьИнформацияОТехподдержке.Заголовок = "";
		Элементы.АктуальнаяВерсия.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПоказатьВерсиюНаФорме( ОтветСервера )
	
	Если ТипЗнч(ОтветСервера) = Тип("Структура") Тогда
		
		АктуальнаяВерсия =  ОтветСервера.АктуальнаяВерсия.Версия;
		СсылкаНаОписаниеАктуальнойВерсии = ОтветСервера.АктуальнаяВерсия.Описание;
		
		Если ОтветСервера.ДоговорДействует Тогда 
			ИнформацияОДоговореТехподдержки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку("Техподдержка действует до %1.", Формат(ОтветСервера.ДатаОкончанияПоддержки, "ДФ=dd.MM.yyyy") );
			Элементы.НадписьИнформацияОТехподдержке.Заголовок = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку("%1", ИнформацияОДоговореТехподдержки);
			Элементы.НадписьИнформацияОТехподдержке.ЦветТекста = Новый Цвет(0, 150, 70);
		Иначе 
			ИнформацияОДоговореТехподдержки = "Нет активного договора техподдержки.";
			Элементы.НадписьИнформацияОТехподдержке.Заголовок = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку("%1", ИнформацияОДоговореТехподдержки);
			Элементы.НадписьИнформацияОТехподдержке.ЦветТекста = Новый Цвет(255, 0, 0);
		КонецЕсли;
	
		Элементы.АктуальнаяВерсия.Видимость = ЗначениеЗаполнено(АктуальнаяВерсия);
		Элементы.АктуальнаяВерсия.Гиперссылка = ЗначениеЗаполнено(СсылкаНаОписаниеАктуальнойВерсии);
		
	Иначе
		Элементы.НадписьИнформацияОТехподдержке.Заголовок = "";
		Элементы.АктуальнаяВерсия.Видимость = Ложь;	
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗапускПриложения(КодВозврата, ДополнительныйПараметр) Экспорт

    а = 1;
    
КонецПроцедуры

